language: scala

jdk:
  - oraclejdk8

sudo: false

branches:
  only:
    - nokcp
    - nokcp-blue
    - nokcp-acl
    - nokcp-blue-acl

addons:
    apt:
        packages:
            - gcc-multilib
            - g++-multilib
            - libstdc++6:i386
            - libgcc1:i386
            - zlib1g:i386
            - libncurses5:i386

scala:
    - 2.11.8

before_cache:
    - find $HOME/.sbt -name "*.lock" | xargs rm
    - find $HOME/.ivy2 -name "*.lock" | xargs rm

cache:
    directories:
        - $HOME/.ivy2
        - $HOME/.sbt

android:
    components:
        - tools
        - build-tools-25.0.2
        - extra-android-m2repository
        - extra-google-m2repository

install:
    - ./travis-ci/setup.sh
    - export NDK_CCACHE=ccache
    - export ARCH=`uname -m`
    - export ANDROID_NDK_HOME=$HOME/.android/android-ndk-r12b
    - export ANDROID_HOME=$HOME/.android/android-sdk-linux
    - export PATH=${ANDROID_NDK_HOME}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${PATH}
    - cp local.properties.travis local.properties

script:
    - sbt native-build android:package-release
    
deploy:
    provider: releases
    file: "/home/travis/build/BROBIRD/shadowsocksr-android/target/android/output/shadowsocksr-blue-acl-release.apk"
    skip_cleanup: true
    api_key:
      secure: 3WzoEwDGyHsc1Yhq4ZIRluQY/rNSBY2vajYzLvaLVVOdqDSDLC4aBXYOiACyPzDDbb37u+y6TMFsnGwYwjcu9jk0AZxwnjm9kB/dtwWnGIzYTn/hxM3XY0BhNTYP9LGsJWcrHLt/71inACOctddgWHDkKyIcuLzXAtQPQwNNlxtE3nIgBddAck4Q0J7LuTj/gN5C+YwbkpJS/n1bJxqL28RLyCaZArLXXJBcO4OivpaBS/B8qjC5O5MzTB2K5zACwBMN4J0wJOyYj7NUwWuTo17bq9W5Clvos7NWE6JYUROFTngktQfB35M2itLHX3GhLSBwvqL+Bbnjd4/xt1Sb3A2IWqT5n2NDbWIN0rAyp7AS9fzEApGKR3d5fn2sz1dcLba9iV9ithYZX2+su+aCE5hFgQgkfATz7xWrl6zSl53415o3NA66MRtKUfatc9QIoJAG/pffUFB29ZuqjSHHhO9qhsuf4tt6WhBl9iBHjnLN3txJBcIkQyEh8tTyw+RZiPQbZl4kBLtruvJ3UNmnhofOVU00ha2n4Cx/o7+xKcvFZC4GZJPvqKJa1eKvhS+ykw80qpYe9DhAENkGouhkgfBup02X3LT/d1KiivUoyLakO9MwLk9aa5IOoLgtrsTVjGHOKVg3PNuGKX14ZaBeL5f++qxshEU9m0AftyjZOiU=
    on:
      tags: true
